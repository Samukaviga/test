import{d as D,o as N,r as R,a as S,u as U,b as q,c as F,e as y,f as d,g as m,w as O,h as k,i as b,t as T,j as E,k as $}from"./index-CCN_L1xM.js";import{_,a as j,b as B}from"./Button-Cwna9c7y.js";import{u as P}from"./contactStore-CdtgSmIU.js";import{_ as K,C as Y}from"./Card-Dz4GJRrq.js";const g="utm:first",V="utm:last",J=90;function h(){return new Date().toISOString()}function M(t){if(!t)return!0;const e=new Date(t);return Date.now()-e.getTime()>J*24*60*60*1e3}function x(t){try{const e=localStorage.getItem(t);if(!e)return null;const n=JSON.parse(e);return M(n?.timestamp)?(localStorage.removeItem(t),null):n}catch{return null}}function w(t,e){localStorage.setItem(t,JSON.stringify({...e,timestamp:h()}))}function W(){const t=new URLSearchParams(window.location.search),e={};return["utm_source","utm_medium","utm_campaign","utm_term","utm_content","gclid","fbclid","msclkid"].forEach(o=>{const u=t.get(o);u&&(e[o]=u)}),e.referrer=document.referrer||void 0,e.landing_page=window.location.href,e}function z(t){const e=(t?.utm_source||"").toLowerCase(),n=(t?.utm_medium||"").toLowerCase(),o=(t?.referrer||"").toLowerCase();return e.includes("google")||t?.gclid?"google_ads":e.includes("facebook")||e.includes("fb")||t?.fbclid?"facebook_ads":e.includes("instagram")?"instagram":e.includes("bing")||e.includes("msclkid")?"bing_ads":e.includes("tiktok")?"tiktok":e.includes("linkedin")?"linkedin":n==="email"||e.includes("mail")?"email":n==="cpc"||n==="paid"||n==="ppc"?"paid_search":e==="direct"||!t?.utm_source&&!o?"direct":o.includes("google.")?"google_organic":o.includes("bing.")?"bing_organic":o.includes("facebook.")?"facebook_organic":o.includes("instagram.")?"instagram_organic":e||void 0}function G(){function t(){const o=W(),u=Object.keys(o).length>2,a=x(g);!a&&u&&w(g,o),u?w(V,o):a||w(g,{referrer:document.referrer||void 0,landing_page:window.location.href,timestamp:h()})}function e(){return x(g)}function n(){return x(V)}return{captureFromUrl:t,getFirst:e,getLast:n,toLeadSource:z}}const H=D({__name:"FormRegister",setup(t){const{captureFromUrl:e,getFirst:n,getLast:o,toLeadSource:u}=G();N(()=>{e()});const a=o()||{},i=n()||{},L=u(a)||u(i)||"direct",s=R({responsible_name:"",student_name:"",indicated_responsible_name:"",indicated_student_name:"",indicated_mobile_phone:"",indicated_email:"",indicated_date_of_birth:"",indicated_education_level:"",lead_source:L,utm_source:a.utm_source??i.utm_source,utm_medium:a.utm_medium??i.utm_medium,utm_campaign:a.utm_campaign??i.utm_campaign,utm_term:a.utm_term??i.utm_term,utm_content:a.utm_content??i.utm_content,gclid:a.gclid??i.gclid,fbclid:a.fbclid??i.fbclid,msclkid:a.msclkid??i.msclkid,referrer:a.referrer??i.referrer,landing_page:a.landing_page??i.landing_page}),f=S({}),p=S(!1),A=U(),C="https://application.colegioitaqua.com.br";async function I(){try{p.value=!0;const c=await B.post(`${C}/api/registrations/`,s);P(c.data.data.id).setContact(c.data.data),A.push(`/sucesso/${c.data.data.id}`)}catch(c){p.value=!1,alert("Oops! Encontramos um erro inesperado. Por favor, tente novamente."),c.response&&c.response.status===422&&(f.value=Object.fromEntries(Object.entries(c.response.data.errors).map(([r,v])=>[r,v[0]])))}}return(c,r)=>{const v=q("mask");return y(),F("form",{class:"flex flex-col gap-3 w-full",onSubmit:E(I,["prevent"])},[r[5]||(r[5]=d("span",{class:"text-gray-700 font-medium mt-0.5"},"Dados do Aluno",-1)),m(_,{modelValue:s.student_name,"onUpdate:modelValue":r[0]||(r[0]=l=>s.student_name=l),placeholder:"Nome do Aluno",required:"","aria-label":"Nome do Aluno",error:f.value.student_name},null,8,["modelValue","error"]),m(_,{modelValue:s.responsible_name,"onUpdate:modelValue":r[1]||(r[1]=l=>s.responsible_name=l),placeholder:"Nome do Responsavel",required:"","aria-label":"Nome do Responsavel",error:f.value.responsible_name},null,8,["modelValue","error"]),r[6]||(r[6]=d("span",{class:"text-gray-700 font-medium mt-0.5"},"Dados do aluno indicado",-1)),m(_,{required:"",name:"indicated_student_name",modelValue:s.indicated_student_name,"onUpdate:modelValue":r[2]||(r[2]=l=>s.indicated_student_name=l),placeholder:"Nome do aluno Indicado",error:f.value.indicated_student_name},null,8,["modelValue","error"]),m(_,{required:"",name:"indicated_responsible_name",modelValue:s.indicated_responsible_name,"onUpdate:modelValue":r[3]||(r[3]=l=>s.indicated_responsible_name=l),placeholder:"Responsavel do aluno Indicado",error:f.value.indicated_responsible_name},null,8,["modelValue","error"]),O(m(_,{modelValue:s.indicated_mobile_phone,"onUpdate:modelValue":r[4]||(r[4]=l=>s.indicated_mobile_phone=l),type:"tel",placeholder:"WhatsApp / Celular do Aluno Indicado",required:"","aria-label":"WhatsApp",error:f.value.indicated_mobile_phone},null,8,["modelValue","error"]),[[v,"(##) #####-####"]]),r[7]||(r[7]=d("div",{class:"flex items-start gap-2 text-sm"},[d("input",{id:"aceito-termos",type:"checkbox",required:"",class:"mt-1 accent-blue-800"}),d("label",{for:"aceito-termos",class:"select-none"}," Li e aceito os Termos do Regulamento. ")],-1)),m(j,{type:"submit",disabled:p.value},{default:k(()=>[b(T(p.value?"Salvando...":"Confirmar"),1)]),_:1},8,["disabled"])],32)}}}),te={__name:"Register",setup(t){return(e,n)=>(y(),$(K,null,{default:k(()=>[m(Y,{class:"max-w-md w-full"},{default:k(()=>[n[0]||(n[0]=d("h2",{class:"text-2xl font-bold text-gray-800 mb-3 text-center"},"Indique um amigo!",-1)),n[1]||(n[1]=d("p",{class:"text-sm text-gray-600 text-center mb-6"},[b(" Preencha todos os campos abaixo para "),d("br"),b(" concorrer a um "),d("span",{class:"font-bold text-blue-900"},"Desconto de at√© 100%, Alexa, Table e um Kit uniforme"),b(". ")],-1)),m(H)]),_:1,__:[0,1]})]),_:1}))}};export{te as default};
